<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>注册 - 分享平台</title>
    <head th:include="head:: head"></head>
    <script type="text/javascript" src="../static/js/bootstrap3-validation.js" th:src="@{/js/bootstrap3-validation.js}"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <link href="../static/css/bootstrap-ie78.css" rel="stylesheet" />
    <script src="../static/js/respond.min.js" ></script>
    <script src="../static/js/html5.js" ></script>
    <![endif]-->
    <script type="text/javascript">
    $(function() {

        $("#form").validation({
            icon: true
        });

        // 要从后台数据确定填的邮箱是不是已注册过了，采用回调方法
        $("form").validation(function(obj,params){
          switch(obj.id){
                case 'email':
                $.post("/verify/Email",{email :$(obj).val()},function(data){
                        params.err = !data.success;
                        params.msg = data.msg;
                });
                break;
                case 'nickName':
                $.post("/verify/NickName",{nickName :$(obj).val()},function(data){
                        params.err = !data.success;
                        params.msg = data.msg;
                });
                break;
          }}
          ,{reqmark:true} //这个参数是设必填不要显示有星号，默认是有星号的
        );

        //.注册
        $("#submit").on('click', function(event) {
            // 2.最后要调用 valid()方法。
            //  valide(object,msg),提示信息显示，object位置后面增加提示信息。如不填object 则自动找最后一个button submit.
            //  valide(msg)

            if ($("#form").valid(this, '内容出错') == false) {
                return false;
            }else{
                $.post("/signup",{email: $("#email").val(),nickName :$("#nickName").val(), password :$("#password").val()},function(data){
                        alert(data.msg);
                        if(data.msg == '注册成功'){
                            $.post("/login",{email: $("#email").val(), password :$("#password").val()},function(data){
                                 location.href="http://localhost/";
                            });
                        }
                });
                return true;
            }

        });

    });

    </script>
    <style type="text/css">
      @media (min-width: 1024px) {
            .btn-space{
                position: relative;
                left: 6%;
            }
        }
    </style>
</head>

<body>
    <div th:include="header:: header" role="navigation" class="zu-top nav-style" data-za-module="TopNavBar" ></div>
    <!-- 水平排列的表单 -->
    <div class="container" style="margin-top:4%">
        <div class="page-header">
            <h1>您好! <small>欢迎注册</small></h1>
        </div>
        <form method="post" class="form-horizontal" action = "javascript:;" id="form" role="form">
            <div class="form-group">
                <label for="email" class="col-sm-2 control-label">Email</label>
                <div class="col-sm-6">
                    <input type="text" class="form-control" id="email" placeholder="xxxx@qq.com" check-type="mail required" />
                </div>
            </div>
            <div class="form-group">
                <label for="nickName" class="col-sm-2 control-label">昵称</label>
                <div class="col-sm-6">
                    <input type="text" class="form-control" id="nickName" check-type="required" required-message="请填写你的大名。" />
                </div>
            </div>
            <div class="form-group">
                <label for="password" class="col-sm-2 control-label">密码</label>
                <div class="col-sm-6">
                    <input type="password" class="form-control" id="password" check-type="required" minlength="6" />
                </div>
            </div>

            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-8">
                        <button type="submit" id="submit" class="btn btn-success col-sm-4">注册</button>
                        <button type="reset" class="btn btn-success col-sm-4
btn-space">重置</button>
                </div>
            </div>
        </form>
    </div>
</body>

</html>
